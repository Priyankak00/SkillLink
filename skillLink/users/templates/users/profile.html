{% extends 'base.html' %}
{% load static %}

{% block title %}My Profile - SkillLink{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'users/css/profile.css' %}">
{% endblock %}

{% block content %}
    <!-- HEADER -->
    <div class="profile-header">
        <div class="profile-header-content">
            <h1><i class="fas fa-user-circle"></i> My Profile</h1>
            <p>Manage your professional profile and build your reputation</p>
        </div>
    </div>

    <!-- MAIN CONTAINER -->
    <div class="profile-container">
        <!-- Error and Success Messages -->
        <div id="errorMessage" style="display: none; background-color: #ff6b6b; color: white; padding: 15px; margin-bottom: 20px; border-radius: 8px; font-weight: 500;">
            <i class="fas fa-exclamation-circle"></i> <span id="errorText"></span>
        </div>
        <div id="successMessage" style="display: none; background-color: #51cf66; color: white; padding: 15px; margin-bottom: 20px; border-radius: 8px; font-weight: 500;">
            <i class="fas fa-check-circle"></i> <span id="successText"></span>
        </div>
        
        <!-- SIDEBAR + MAIN CONTENT GRID -->
        <div class="profile-grid">
            <!-- SIDEBAR -->
            <div class="profile-sidebar">
                <!-- PROFILE CARD -->
                <div class="profile-card">
                    <div class="profile-avatar-section">
                        <div class="profile-avatar">
                            {% if user.profile_picture %}
                                <img id="avatarPreview" src="{{ user.profile_picture.url }}" alt="Profile Avatar" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                            {% else %}
                                <img id="avatarPreview" src="https://ui-avatars.com/api/?name={{ user.first_name|urlencode }}+{{ user.last_name|urlencode }}&size=200&background=667eea&color=fff" alt="Profile Avatar" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
                            {% endif %}
                            <label for="avatarUpload" class="avatar-upload-label" title="Change profile picture">
                                <i class="fas fa-camera"></i>
                            </label>
                            <input type="file" id="avatarUpload" class="avatar-input" accept="image/*">
                        </div>
                        <h2 id="profileName">{{ user.first_name }} {{ user.last_name }}</h2>
                        <p id="profileTitle">{{ user.title|default:"No title set" }}</p>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="projectsCount">24</div>
                            <div class="stat-label">Projects</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="earnedAmount">$8.5K</div>
                            <div class="stat-label">Earned</div>
                        </div>
                    </div>

                    <div class="profile-rating">
                        <div class="stars-display">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="rating-text">4.9 out of 5 (152 reviews)</div>
                    </div>

                    <div class="quick-actions">
                        <a href="{% url 'dashboard' %}" class="action-btn action-btn-primary" style="text-decoration: none;">
                            <i class="fas fa-chart-line"></i> Go to Dashboard
                        </a>
                        <button class="action-btn action-btn-primary" id="editProfileBtn">
                            <i class="fas fa-edit"></i> Edit Profile
                        </button>
                        <button class="action-btn action-btn-secondary">
                            <i class="fas fa-file-download"></i> Download CV
                        </button>
                        <button class="action-btn action-btn-secondary">
                            <i class="fas fa-share-alt"></i> Share Profile
                        </button>
                        <a href="{% url 'logout' %}" class="action-btn action-btn-secondary" style="text-decoration: none; background-color: #ff6b6b; color: white;">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </a>
                    </div>
                </div>
            </div>

            <!-- CONTENT AREA -->
            <div class="profile-content">
                <!-- ABOUT SECTION -->
                <div class="content-section">
                    <div class="content-section-header">
                        <h2 class="section-title">
                            <i class="fas fa-align-left"></i> About Me
                        </h2>
                        <button class="edit-btn" onclick="editSection('about')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    <div class="content-section-body">
                        <p id="aboutText" class="info-description">
                            {{ user.bio|default:"No bio added yet. Click Edit to add your professional bio." }}
                        </p>
                    </div>
                </div>

                <!-- SKILLS SECTION -->
                <div class="content-section">
                    <div class="content-section-header">
                        <h2 class="section-title">
                            <i class="fas fa-star"></i> Skills & Expertise
                        </h2>
                        <button class="edit-btn" id="addSkillBtn" onclick="openSkillsModal()">
                            <i class="fas fa-plus"></i> Add Skill
                        </button>
                    </div>
                    <div class="content-section-body">
                        <div class="skills-container" id="skillsContainer">
                            {% if user.skills %}
                                {% for skill in user.skills %}
                                    <div class="skill-tag">
                                        {{ skill }}
                                        <span class="skill-remove" onclick="removeSkill(this)">✕</span>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <p style="color: #666; font-style: italic;">No skills added yet. Click "Add Skill" to get started.</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- WORK EXPERIENCE & PORTFOLIO TABS -->
                <div class="content-section">
                    <div class="content-section-header">
                        <h2 class="section-title">
                            <i class="fas fa-briefcase"></i> Work & Portfolio
                        </h2>
                    </div>
                    <div class="content-section-body">
                        <div class="tab-buttons">
                            <button class="tab-btn active" onclick="switchTab(event, 'portfolio')">
                                <i class="fas fa-images"></i> Portfolio (12)
                            </button>
                            <button class="tab-btn" onclick="switchTab(event, 'reviews')">
                                <i class="fas fa-comments"></i> Reviews (45)
                            </button>
                        </div>

                        <!-- PORTFOLIO TAB -->
                        <div id="portfolio" class="tab-content active">
                            <div style="padding-top: 20px;">
                                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 15px;">
                                    <div style="aspect-ratio: 1; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; cursor: pointer;">
                                        <i class="fas fa-image"></i>
                                    </div>
                                    <div style="aspect-ratio: 1; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; cursor: pointer;">
                                        <i class="fas fa-palette"></i>
                                    </div>
                                    <div style="aspect-ratio: 1; background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; cursor: pointer;">
                                        <i class="fas fa-pencil-alt"></i>
                                    </div>
                                    <div style="aspect-ratio: 1; background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); border-radius: 12px; display: flex; align-items: center; justify-content: center; color: white; font-size: 2rem; cursor: pointer;">
                                        <i class="fas fa-star"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- REVIEWS TAB -->
                        <div id="reviews" class="tab-content">
                            <div style="padding-top: 20px;">
                                <div class="review-item">
                                    <div class="review-header">
                                        <div class="review-client">Alex Johnson</div>
                                        <div class="review-rating">★★★★★</div>
                                    </div>
                                    <div class="review-text">
                                        Sarah is an exceptional designer with great attention to detail. She delivered the project ahead of schedule and exceeded all my expectations. Highly recommended!
                                    </div>
                                    <div class="review-date">2 months ago</div>
                                </div>

                                <div class="review-item">
                                    <div class="review-header">
                                        <div class="review-client">Emma Davis</div>
                                        <div class="review-rating">★★★★★</div>
                                    </div>
                                    <div class="review-text">
                                        Excellent communication and professional approach. The designs were modern, clean, and exactly what we needed. Will definitely work together again!
                                    </div>
                                    <div class="review-date">3 months ago</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CONTACT INFO SECTION -->
                <div class="content-section">
                    <div class="content-section-header">
                        <h2 class="section-title">
                            <i class="fas fa-phone"></i> Contact Information
                        </h2>
                        <button class="edit-btn" onclick="editSection('contact')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                    </div>
                    <div class="content-section-body">
                        <div class="info-grid">
                            <div class="info-item">
                                <div class="info-label"><i class="fas fa-envelope"></i> Email</div>
                                <div class="info-value" id="contactEmail">{{ user.email|default:"Not provided" }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label"><i class="fas fa-user"></i> Username</div>
                                <div class="info-value" id="contactUsername">{{ user.username }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label"><i class="fas fa-tag"></i> Category</div>
                                <div class="info-value" id="contactCategory">{{ user.get_category_display|default:"Not specified" }}</div>
                            </div>
                            <div class="info-item">
                                <div class="info-label"><i class="fas fa-user-tag"></i> Role</div>
                                <div class="info-value" id="contactRole">{{ user.get_role_display }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- EDIT MODAL -->
    <div class="modal-backdrop" id="editModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Edit Profile</h3>
                <button class="modal-close" onclick="closeModal()">✕</button>
            </div>

            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>

            <form id="editForm">
                {% csrf_token %}
                <div class="form-group">
                    <label for="editName"><i class="fas fa-user"></i> Full Name</label>
                    <input type="text" id="editName" placeholder="Enter your full name">
                </div>

                <div class="form-group">
                    <label for="editTitle"><i class="fas fa-briefcase"></i> Professional Title</label>
                    <input type="text" id="editTitle" placeholder="e.g., UI/UX Designer">
                </div>

                <div class="form-group">
                    <label for="editAbout"><i class="fas fa-align-left"></i> About Me</label>
                    <textarea id="editAbout" placeholder="Tell us about yourself..."></textarea>
                </div>

                <div class="form-group">
                    <label for="editBio"><i class="fas fa-align-left"></i> Bio</label>
                    <textarea id="editBio" placeholder="Short bio..."></textarea>
                </div>

                <div class="form-group">
                    <label for="editEmail"><i class="fas fa-envelope"></i> Email</label>
                    <input type="email" id="editEmail" placeholder="your@email.com">
                </div>

                <div class="form-group">
                    <label for="editPhone"><i class="fas fa-phone"></i> Phone</label>
                    <input type="tel" id="editPhone" placeholder="+1 (555) 123-4567">
                </div>

                <div class="form-group">
                    <label for="editLocation"><i class="fas fa-map-marker-alt"></i> Location</label>
                    <input type="text" id="editLocation" placeholder="City, Country">
                </div>

                <div class="form-group">
                    <label for="editRate"><i class="fas fa-dollar-sign"></i> Hourly Rate</label>
                    <input type="number" id="editRate" placeholder="50" min="0">
                </div>

                <div class="form-group">
                    <label for="editSkill"><i class="fas fa-plus"></i> Add New Skill</label>
                    <input type="text" id="editSkill" placeholder="Type a skill name">
                </div>

                <div class="form-actions">
                    <button type="submit" class="save-btn">
                        <i class="fas fa-check"></i> Save Changes
                    </button>
                    <button type="button" class="cancel-btn" onclick="closeModal()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- SKILLS MODAL -->
    <div class="modal-backdrop" id="skillsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Manage Skills</h3>
                <button class="modal-close" onclick="closeSkillsModal()">✕</button>
            </div>

            <div class="error-message" id="skillsErrorMessage"></div>
            <div class="success-message" id="skillsSuccessMessage"></div>

            <div style="margin-bottom: 20px;">
                <label for="newSkillInput" style="display: block; margin-bottom: 10px; font-weight: 600;"><i class="fas fa-plus"></i> Add New Skill</label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="newSkillInput" placeholder="Enter skill name (e.g., Python, UI Design)" style="flex: 1; padding: 10px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 0.9rem;">
                    <button type="button" id="addSkillBtnModal" class="save-btn" style="padding: 10px 20px;">
                        <i class="fas fa-plus"></i> Add
                    </button>
                </div>
            </div>

            <div>
                <label style="display: block; margin-bottom: 10px; font-weight: 600;"><i class="fas fa-tags"></i> Your Skills</label>
                <div id="skillsListContainer" style="display: flex; flex-wrap: wrap; gap: 10px; min-height: 60px; padding: 15px; background: #f9f9f9; border-radius: 8px;">
                    <p style="color: #999; font-style: italic; width: 100%;">No skills added yet</p>
                </div>
            </div>

            <div class="form-actions" style="margin-top: 20px;">
                <button type="button" class="save-btn" onclick="saveSkills()">
                    <i class="fas fa-check"></i> Save Skills
                </button>
                <button type="button" class="cancel-btn" onclick="closeSkillsModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
{% endblock %}

{% block extra_js %}
<script src="{% static 'users/js/profile.js' %}"></script>
{% endblock %}
